# -*- coding: utf-8 -*-

import pandas as pd
from io import StringIO


# 지자체 서버별로 상이할 수 있으니 임포트 전 단말제조사별 코드 필히 확인바람!!
# [충북옥천 단말제조사코드]
company_map = {
    "ISTEC":        1,
    "하이텍":        2,
    "위지트":        3,
    "한영계기":      4,
    "레오테크":      5,
    "가암":          7,
    "유비콤":        8,
    "영아이티":      9,
    "유솔":         10,
    "유솔(수용가X)": 11,
                            #"그린플로우":    12,
    "한진테크":      12,
    "경성제닉스":    13,
    "test222":      21,
    "ISTEC2":       37  # 테스트용
}


# 지자체 소속명추가해서 활용 → site_sq 매핑
site_map = {
    "충북옥천": 4,
    "검증기": 37,

}



""" DSC에서 블록정보 조회시 아래 쿼리 활용
SELECT blk_sq AS district, blk_nm
FROM public.tb_m1_info_block
ORDER BY blk_sq ASC;
"""
blk_map = {
    "BASIC": 1,
    "옥천군": 2,
    "청산면": 9,
    "군북면": 11,
    "옥천읍": 15,
    "군서면": 17,
    "안내면": 18,
    "안남면": 19,
    "청성면": 20,
    "이원면": 21,
    "동이면": 22,
    "아파트": 23,
    "지하수": 24
}


# 원시 텍스트 (탭 구분), out2 서식에 맞춰 21개 컬럼순서 지킬것!
raw_text = """
    
    
성진개발,정서연	01-000130-00-000		옥천읍 죽향리 215	127.5762	36.3154	일반용	동	옥천읍	010-5767-4647	2025		25	25-S500126	50	LG	ASN_CSE-D-660817dc02-S030	01251744098	한진테크	2025-06-04
㈜스마트시티산업	09-000121-00-000		옥천읍 삼양리 200-43	127.5659	36.3063	일반용	동	옥천읍	010-2298-6622	2025		25	23-D320206	32	LG	ASN_CSE-D-4a1ebce4d0-S030	01252304406	한진테크	2025-06-09
김명성	11-000002-00-000		옥천읍 서대리 222(라이온스)	127.5764	36.2837	일반용	동	옥천읍	010-5407-6809	2025		25	24-D200672	20	LG	ASN_CSE-D-39c4e086c8-S030	01252304492	한진테크	2025-05-27
김명성	11-000004-00-000		옥천읍 응천1길 105(정미소)	127.5757	36.2835	일반용	동	옥천읍	010-5407-6809	2025		25	25-S002103	15	LG	ASN_CSE-D-aa066465a5-S030	01252304443	한진테크	2025-05-27
김명성	11-000004-00-020		옥천읍 응천1길 107	127.5761	36.2835	가정용	동	옥천읍	010-5407-6809	2025		25	24-D200670	20	LG	ASN_CSE-D-a1ea85b756-S030	01252304473	한진테크	2025-05-27
김경희	14-000313-01-000		옥천읍 응천1길 91-4	127.57505	36.2843	가정용	동	옥천읍	010-3431-5262	2025		25	24-S016427	15	LG	ASN_CSE-D-c5615321bb-S030	01252304484	한진테크	2025-06-02
유삼봉	15-000512-00-000		옥천읍 마암리 423-4	127.5573	36.2919	가정용	동	옥천읍	010-5468-2191	2025		25	23-D200484	20	LG	ASN_CSE-D-633d4f53fe-S030	01252304421	한진테크	2025-06-11
강형근	16-000290-00-090		옥천읍 성암응천길 8	127.5701	36.2918	가정용	동	옥천읍	010-5490-7736	2025		25	25-S002085	15	LG	ASN_CSE-D-5b210c8430-S030	01252304508	한진테크	2025-05-10
㈜충청금속,박찬용	30-000050-00-000		옥천읍 가풍리 1119	127.5901	36.27301	일반용	동	옥천읍	010-5491-8670	2025		25	25-S250077	25	LG	ASN_CSE-D-015d33e6ca-S030	01252304513	한진테크	2025-05-27
임종안	31-000299-00-020		옥천읍 가풍2길 30-1	127.5788	36.2569	가정용	동	옥천읍	010-9073-1753	2025		25	25-S002102	15	LG	ASN_CSE-D-f942c26f27-S030	01252304497	한진테크	2025-05-27
유재한	33-000042-00-000		옥천읍 서대구일로5길 26	127.5961	36.2904	가정용	동	옥천읍	010-5422-9959	2025		25	25-S002083	15	LG	ASN_CSE-D-b3d4a04c8c-S030	01252304467	한진테크	2025-05-27
한국농어촌공사옥천,영동지사	39-000257-00-000		군북면 이백리 437	127.5341	36.3288	일반용	동	군북면	730-2552	2025		25	24-D500126	50	LG	ASN_CSE-D-fb80a5b2d2-S030	01252304503	한진테크	2025-04-20
김중관	42-000200-00-000		군북면 증약2길 114	127.5105	36.3455	가정용	동	군북면	010-3569-7688	2025		25	25-S002117	15	LG	ASN_CSE-D-9ccd313e83-S030	01252304491	한진테크	2025-05-26
김효석	42-000220-00-000		군북면 증약리 945-7	127.5093	36.3434	가정용	동	군북면	010-5407-7790	2025		25	25-S002110	15	LG	ASN_CSE-D-2479cc2b24-S030	01252304509	한진테크	2025-06-07
안재영	42-000239-00-000		군북면 증약2길 79	127.51309	36.3439	가정용	동	군북면	010-6324-2358	2025		25	25-S002120	15	LG	ASN_CSE-D-f11cc59be2-S030	01252304474	한진테크	2025-05-14
유신유화	42-000357-00-000		군북면 증약리 469-14	127.5234	36.3477	일반용	동	군북면	010-6402-8298	2025		25	25-S002032	15	LG	ASN_CSE-D-0060d0dc65-S030	01252304475	한진테크	2025-06-02
김현종	42-000515-00-000		군북면 증약리 305-21	127.5291	36.3513	가정용	동	군북면	010-8233-2626	2025		25	25-S002096	15	LG	ASN_CSE-D-1688ead80f-S030	01252303926	한진테크	2025-05-14
황규연	42-000605-00-010		군북면 증약리 340	127.5272	36.3553	가정용	동	군북면	010-4031-2099	2025		25	25-S002084	15	LG	ASN_CSE-D-6d426dc74d-S030	01252304430	한진테크	2025-04-28
이진규	42-000621-00-000		군북면 증약리 324-5	127.5292	36.3549	가정용	동	군북면	010-4445-1099	2025		25	24-D200681	20	LG	ASN_CSE-D-e5de618a1f-S030	01251760501	한진테크	2025-04-07
㈜강복건설	42-000901-00-000		군북면 증약리 1298	127.5265	36.3634	일반용	동	군북면	010-6212-1403	2025		25	25-D200679	20	LG	ASN_CSE-D-5f46a13217-S030	01252304511	한진테크	2025-04-14
청정테크㈜,조은경	42-040049-00-000		군북면 대정리 138-7	127.5492	36.3906	일반용	동	군북면	010-5438-3311	2025		25	24-S251169	25	LG	ASN_CSE-D-405d8ac4ab-S030	01252304449	한진테크	2025-06-02
강완봉	44-200227-00-000		군북면 막지리 168	127.6029	36.3822	가정용	동	군북면	010-2114-3803	2025		25	25-S002112	15	LG	ASN_CSE-D-95dfc7165f-S030	01252304460	한진테크	2025-05-17
문진수	47-000013-00-050		동이면 평산리 873	127.6164	36.2855	가정용	동	동이면	010-8806-9593	2025		25	25-S002114	15	LG	ASN_CSE-D-d753bb3835-S030	01252304440	한진테크	2025-05-10
이동근	56-000082-00-000		동이면 석탄리 산23-36	127.6234	36.3139	가정용	동	동이면	010-5406-3898	2025		25	25-S002031	15	LG	ASN_CSE-D-331cc5719d-S030	01252304486	한진테크	2025-05-27
박영구	63-000194-00-000		이원면 건진리 170-2	127.6203	36.2482	가정용	동	이원면	010-5406-2166	2025		25	25-S002036	15	LG	ASN_CSE-D-e1b6c9dbe2-S030	01252304493	한진테크	2025-05-27
이동진	75-000015-00-020		이원면 백지1길 35	127.6778	36.2354	가정용	동	이원면	010-7150-3291	2025		25	25-S002118	15	LG	ASN_CSE-D-7db1f82bae-S030	01252304502	한진테크	2025-05-12
고금주	75-000015-00-030		이원면 백지2길 34	127.6782	36.2316	가정용	동	이원면	010-2545-0927	2025		25	25-S002105	15	LG	ASN_CSE-D-f6932a85c4-S030	01252304504	한진테크	2025-06-03
농업기술센터(농촌활력과)	80-000001-01-000		이원면 이원로 443-1(1호)	127.6294	36.21301	일반용	동	이원면	730-3882	2025		25	25-S002086	15	LG	ASN_CSE-D-887fe1fc7e-S030	01251463015	한진테크	2025-05-10
농업기술센터(농촌활력과)	80-000001-02-000		이원면 이원로 443-1(2호)	127.6294	36.21301	일반용	동	이원면	730-3882	2025		25	25-S002082	15	LG	ASN_CSE-D-2edd25df4a-S030	01252304453	한진테크	2025-05-10
농업기술센터(농촌활력과)	80-000001-03-000		이원면 이원로 443-1(3호)	127.6294	36.21301	일반용	동	이원면	730-3882	2025		25	25-S002089	15	LG	ASN_CSE-D-3002d1c7f0-S030	01252304510	한진테크	2025-05-10
농업기술센터(농촌활력과)	80-000001-04-000		이원면 이원로 443-1(4호)	127.6294	36.21301	일반용	동	이원면	730-3882	2025		25	25-S002090	15	LG	ASN_CSE-D-df8329a6c2-S030	01252304444	한진테크	2025-05-10
농업기술센터(농촌활력과)	80-000001-05-000		이원면 이원로 443-1(5호)	127.6294	36.21301	일반용	동	이원면	730-3882	2025		25	25-S002088	15	LG	ASN_CSE-D-3427f668c8-S030	01252304455	한진테크	2025-05-12
농업기술센터(농촌활력과)	80-000001-06-000		이원면 이원로 443-1(6호)	127.6294	36.21301	일반용	동	이원면	730-3882	2025		25	25-S002081	15	LG	ASN_CSE-D-60e17a2507-S030	01252304452	한진테크	2025-05-12
고영기	90-000346-00-000		청산면 지전리 213	127.7884	36.3477	가정용	동	청산면	010-5291-7297	2025		25	25-S002108	15	LG	ASN_CSE-D-353463c3e5-S030	01252304320	한진테크	2025-06-02
백창현	94-150499-00-009		안내면 안내회남로 499-9	127.6161	36.3939	가정용	동	안내면	010-3363-0207	2025		25	25-S002033	15	LG	ASN_CSE-D-79dd236d0f-S030	01252304354	한진테크	2025-06-03

"""

# 각 줄을 리스트로 변환
lines = raw_text.strip().splitlines()
rows = [line.split('\t') for line in lines]

# 열 정의 및 데이터프레임 생성
columns = [
    "cust_name", "admin_no", "addr", "addr_new", "loc_lng", "loc_lat",
    "business_name", "site_name", "addr_region", "cust_phone",
    "set_years", "read_responsi", "check_day", "meter_no", "pipe_diameter",
    "ami_type", "sub_dev_no", "dev_no", "company_name", "ins_dt"
]

df = pd.DataFrame(rows, columns=columns)

# 지자체 DSC로 임포트시 사전체크하고 변동사항은 위에서 테이블 갱신후 사용할 것!
# 1 . 어느지자체인가?
# 2 . 블록은 db에 모두 등록된상태
# 3 . 추가된 단말제조사는 없나?
######################################################################
df["site_sq"] = site_map["충북옥천"]
#df["site_sq"] = site_map["검증기"]
df["blk_sq"] = df["addr_region"].map(blk_map) 
df["company_sq"] = df["company_name"].map(company_map)
######################################################################

# 컬럼 순서 정의
df = df[[ 
    "admin_no", "cust_name", "addr", "addr_new", "loc_lng", "loc_lat",
    "business_name", "site_sq", "blk_sq", "cust_phone", "set_years",
    "read_responsi", "check_day", "meter_no", "pipe_diameter",
    "ami_type", "sub_dev_no", "dev_no", "company_sq", "ins_dt"
]]

# SQL 포맷 생성
def format_sql_row(row):
    return "(" + ", ".join([
        f"'{row['admin_no']}'", f"'{row['cust_name']}'", f"'{row['addr']}'", f"'{row['addr_new']}'",
        f"{row['loc_lng']}", f"{row['loc_lat']}", f"'{row['business_name']}'", f"{row['site_sq']}",
        f"{row['blk_sq']}", f"'{row['cust_phone']}'", f"'{row['set_years']}'", f"'{row['read_responsi']}'",
        f"{row['check_day']}", f"'{row['meter_no']}'", f"{row['pipe_diameter']}", f"'{row['ami_type']}'",
        f"'{row['sub_dev_no']}'", f"'{row['dev_no']}'", f"{row['company_sq']}", f"'{row['ins_dt']}'::timestamp"
    ]) + ")"

formatted_rows = [format_sql_row(row) for _, row in df.iterrows()]
output_sql = "VALUES\n" + ",\n".join(formatted_rows) + ";"

print(output_sql)
