# =============================================
# ğŸ“Œ ì—‘ì…€ â†’ SQL VALUES ë³€í™˜ê¸°
# ì‘ì„±ì: ì„œê¸°ëŒ€
# ëª©ì : ìˆ˜ìš©ê°€ ë‹¨ë§ê¸° ë“±ë¡ìš© ì—‘ì…€ íŒŒì¼ì„ SQL VALUES êµ¬ë¬¸ìœ¼ë¡œ ìë™ ë³€í™˜
# ì£¼ìš” ê¸°ëŠ¥:
#   - ì—‘ì…€ íŒŒì¼ ì„ íƒ ì°½ ì œê³µ
#   - ì •í•´ì§„ 20ê°œ ì»¬ëŸ¼ ê¸°ì¤€ìœ¼ë¡œ ë°ì´í„° íŒŒì‹±
#   - ì„±ê³µ/ì‹¤íŒ¨ í•­ëª© ìˆ˜ ì§‘ê³„
#   - ìˆ˜ìš©ê°€ë²ˆí˜¸ ëª©ë¡ ë° SQL VALUES êµ¬ë¬¸ ì¶œë ¥
#   - ê¸´ í…ìŠ¤íŠ¸ë¥¼ ê°€ë¡œ/ì„¸ë¡œ ìŠ¤í¬ë¡¤ ê°€ëŠ¥í•˜ê²Œ ì¶œë ¥
# =============================================

import pandas as pd
import tkinter as tk
from tkinter import filedialog, messagebox
from datetime import datetime

# ğŸ“Œ ì—‘ì…€ ì»¬ëŸ¼ëª… ì •ì˜ (20ê°œ í•­ëª©)
COLUMNS = [
    'ìˆ˜ìš©ê°€ëª…', 'ìˆ˜ìš©ê°€ë²ˆí˜¸', 'êµ¬ì£¼ì†Œ', 'ì‹ ì£¼ì†Œ', 'ê²½ë„', 'ìœ„ë„', 'ì—…ì¢…', 'ì†Œì†',
    'ë¸”ë¡', 'ìˆ˜ìš©ê°€ ì „í™”ë²ˆí˜¸', 'ìˆ˜ìš©ê°€ ëŒ€ìƒ ë…„ë„', 'ê²€ì¹¨ì›', 'ê²€ì¹¨ì¼', 'ê³„ëŸ‰ê¸°ë²ˆí˜¸',
    'êµ¬ê²½', 'í†µì‹ ', 'ë‹¨ë§ ë¶€ë²ˆí˜¸', 'ë‹¨ë§ ì£¼ë²ˆí˜¸', 'ë‹¨ë§ íšŒì‚¬', 'ë‹¨ë§ ì„¤ì¹˜ì¼'
]

# ğŸ“Œ ê¸°ë³¸ê°’ ì„¤ì • (ì†Œì†, ë‹¨ë§íšŒì‚¬)
SITE_SQ = 4
COMPANY_SQ = 9

# ğŸ“Œ ì—‘ì…€ íŒŒì¼ì„ ì½ê³  SQL VALUES êµ¬ë¬¸ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
def generate_sql_from_excel():
    # íŒŒì¼ ì„ íƒ ì°½ ì—´ê¸°
    file_path = filedialog.askopenfilename(title="ì—‘ì…€ íŒŒì¼ ì„ íƒ", filetypes=[("Excel files", "*.xlsx *.xls")])
    if not file_path:
        messagebox.showwarning("íŒŒì¼ ì„ íƒ", "íŒŒì¼ì´ ì„ íƒë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.")
        return

    try:
        # ì—‘ì…€ ë°ì´í„°í”„ë ˆì„ ë¶ˆëŸ¬ì˜¤ê¸° ë° ê³µë°± ì±„ì›€
        df = pd.read_excel(file_path, dtype=str).fillna('')
        df = df.iloc[:, 1:1+len(COLUMNS)]  # ì²« ì—´ ì œì™¸ í›„ 20ì—´ë§Œ ì„ íƒ
        df.columns = COLUMNS

        values_list = []
        success_count = 0
        fail_count = 0
        success_admin_no_list = []  # ì„±ê³µí•œ ìˆ˜ìš©ê°€ë²ˆí˜¸ ì €ì¥

        # ê° í–‰ ë°˜ë³µ ì²˜ë¦¬
        for idx, row in df.iterrows():
            try:
                # SQLìš© íŠœí”Œ ê°’ ìƒì„±
                values = (
                    row['ìˆ˜ìš©ê°€ëª…'],
                    row['ìˆ˜ìš©ê°€ë²ˆí˜¸'],
                    row['êµ¬ì£¼ì†Œ'],
                    row['ì‹ ì£¼ì†Œ'],
                    float(row['ê²½ë„']),
                    float(row['ìœ„ë„']),
                    row['ì—…ì¢…'],
                    SITE_SQ,
                    COMPANY_SQ,
                    row['ìˆ˜ìš©ê°€ ì „í™”ë²ˆí˜¸'],
                    row['ìˆ˜ìš©ê°€ ëŒ€ìƒ ë…„ë„'],
                    row['ê²€ì¹¨ì›'],
                    int(row['ê²€ì¹¨ì¼']),
                    row['ê³„ëŸ‰ê¸°ë²ˆí˜¸'],
                    int(row['êµ¬ê²½']),
                    row['í†µì‹ '],
                    row['ë‹¨ë§ ë¶€ë²ˆí˜¸'],
                    row['ë‹¨ë§ ì£¼ë²ˆí˜¸'],
                    COMPANY_SQ,
                    f"{pd.to_datetime(row['ë‹¨ë§ ì„¤ì¹˜ì¼']).date()}"
                )
                # SQL VALUES ë¬¸ìì—´ í¬ë§·íŒ…
                formatted = "('{}', '{}', '{}', '{}', {}, {}, '{}', {}, {}, '{}', '{}', '{}', {}, '{}', {}, '{}', '{}', '{}', {}, '{}'::timestamp)".format(*values)
                values_list.append(formatted)
                success_admin_no_list.append(row['ìˆ˜ìš©ê°€ë²ˆí˜¸'])
                success_count += 1
            except Exception as e:
                values_list.append(f"-- [ERROR #{idx+1}] {e}")
                fail_count += 1

        # ê²°ê³¼ ì¶œë ¥ì°½ ì´ˆê¸°í™” ë° ê²°ê³¼ ì‚½ì…
        result_text.config(state=tk.NORMAL)
        result_text.delete(1.0, tk.END)

        # âœ… ìˆ˜ìš©ê°€ë²ˆí˜¸ ëª©ë¡ ë¨¼ì € ì¶œë ¥
        result_text.insert(tk.END, "-- âœ… ì„í¬íŠ¸ì „ ì¡°íšŒí•  ìˆ˜ìš©ê°€ëª©ë¡\n")
        result_text.insert(tk.END, ",\n".join(f"'{x}'" for x in success_admin_no_list) + "\n\n")

        # âœ… ì„±ê³µ/ì‹¤íŒ¨ í†µê³„ ì¶œë ¥
        result_text.insert(tk.END, f"-- ì´ {len(df)}ê°œ ì¤‘ {success_count}ê°œ ì„±ê³µ, {fail_count}ê°œ ì‹¤íŒ¨\n\n")

        # âœ… SQL VALUES ì¶œë ¥
        result_text.insert(tk.END, ",\n".join(values_list))
        result_text.config(state=tk.DISABLED)

    except Exception as e:
        messagebox.showerror("ì—ëŸ¬ ë°œìƒ", str(e))


# =====================
# ğŸ“Œ GUI êµ¬ì„± (Tkinter)
# =====================
window = tk.Tk()
window.title("ì—‘ì…€ â†’ SQL VALUES ë³€í™˜ê¸°")
window.geometry("1000x600")

# â–¶ ë²„íŠ¼ êµ¬ì„±
btn = tk.Button(window, text="ì—‘ì…€ íŒŒì¼ ì„ íƒ ë° SQL ë³€í™˜", command=generate_sql_from_excel)
btn.pack(pady=10)

# â–¶ ê²°ê³¼ ì¶œë ¥ í”„ë ˆì„
frame = tk.Frame(window)
frame.pack(fill=tk.BOTH, expand=True, padx=10, pady=10)

# â–¶ ê°€ë¡œ ìŠ¤í¬ë¡¤ë°”
x_scrollbar = tk.Scrollbar(frame, orient=tk.HORIZONTAL)
x_scrollbar.pack(side=tk.BOTTOM, fill=tk.X)

# â–¶ ì„¸ë¡œ ìŠ¤í¬ë¡¤ë°”
y_scrollbar = tk.Scrollbar(frame)
y_scrollbar.pack(side=tk.RIGHT, fill=tk.Y)

# â–¶ ê²°ê³¼ ì¶œë ¥ í…ìŠ¤íŠ¸ì°½ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥)
result_text = tk.Text(frame, wrap=tk.NONE, xscrollcommand=x_scrollbar.set, yscrollcommand=y_scrollbar.set)
result_text.pack(side=tk.LEFT, fill=tk.BOTH, expand=True)

x_scrollbar.config(command=result_text.xview)
y_scrollbar.config(command=result_text.yview)

# â–¶ ë©”ì¸ ë£¨í”„ ì‹¤í–‰
window.mainloop()
